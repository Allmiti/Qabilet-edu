<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flood Prediction Map - Kazakhstan</title>
    <style>
        #map {
            width: 100%;
            height: 90vh;
        }
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: rgba(255, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: none;
        }
    </style>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
</head>
<body>
    <div id="map"></div>
    <div id="notification" class="notification">Warning: You are in a potential flood zone!</div>

    <script>
        mapboxgl.accessToken = 'your-mapbox-access-token';

        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v11',
            center: [69.2, 48.0], // Coordinates for Kazakhstan
            zoom: 5
        });

        const floodDataEndpoint = "https://api.ventusky.com/flood-data-endpoint"; // Replace with actual API endpoint

        async function getFloodData() {
            try {
                const response = await fetch(floodDataEndpoint);
                const data = await response.json();
                highlightFloodZones(data);
            } catch (error) {
                console.error("Error fetching flood data:", error);
            }
        }

        function highlightFloodZones(data) {
            data.zones.forEach(zone => {
                const floodZone = {
                    type: "Feature",
                    geometry: {
                        type: "Polygon",
                        coordinates: zone.coordinates
                    }
                };

                map.addSource(`floodZone-${zone.id}`, {
                    type: "geojson",
                    data: floodZone
                });

                map.addLayer({
                    id: `floodZoneLayer-${zone.id}`,
                    type: "fill",
                    source: `floodZone-${zone.id}`,
                    layout: {},
                    paint: {
                        "fill-color": "rgba(255, 0, 0, 0.5)",
                        "fill-outline-color": "red"
                    }
                });

                checkUserLocation(zone);
            });
        }

        function checkUserLocation(zone) {
            navigator.geolocation.getCurrentPosition(position => {
                const userCoords = [position.coords.longitude, position.coords.latitude];
                if (insidePolygon(userCoords, zone.coordinates[0])) {
                    showNotification();
                }
            });
        }

        function insidePolygon(point, vs) {
            let x = point[0], y = point[1];

            let inside = false;
            for (let i = 0, j = vs.length - 1; i < vs.length; j = i++) {
                let xi = vs[i][0], yi = vs[i][1];
                let xj = vs[j][0], yj = vs[j][1];

                let intersect = ((yi > y) !== (yj > y)) &&
                    (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
                if (intersect) inside = !inside;
            }

            return inside;
        }

        function showNotification() {
            const notification = document.getElementById('notification');
            notification.style.display = 'block';
            setTimeout(() => notification.style.display = 'none', 5000);
        }

        map.on('load', () => {
            getFloodData();
        });
    </script>
</body>
</html>
